ll <- loglik_orthog_nd(O = O, mu = mu, sigLtil = sigLtil,sigRtil =  sigRtil, pd = pd, ctil = ctil, envdat_ex, pa )
loglik_orthog_nd = function(O, mu, sigLtil, sigRtil, pd, ctil, envdat, pa, num_threads = RcppParallel::defaultNumThreads())
{
  RcppParallel::setThreadOptions(numThreads = num_threads)
  
  #get the probability of detection for each location
  logpdetect = logprobdetect(O = O,
                             mu = mu,
                             sigLtil = sigLtil,
                             sigRtil = sigRtil,
                             pd = pd,
                             ctil = ctil,
                             envdat = envdat)
  
  #now get the log likelihood and return
  #res = sum(pa*logpdetect+(1-pa)*log(1-exp(logpdetect)))
  #this is what you want but you probably want to use
  #a log1mexp type function for numeric stability
  res = sum(pa*logpdetect + (1 - pa)*copula::log1mexp(-logpdetect)) 
  #copula::log1mexp(a) for positive a is actually log(1-exp(-a)) 
  #for some reason 
  
  RcppParallel::setThreadOptions(numThreads = RcppParallel::defaultNumThreads())
  return(res)
}