absence_points <- spatSample(r_vsp_absence, size = 20, na.rm=TRUE, xy = TRUE)
presence_points
absence_points
presence_points %>%
rbind(absence_points)
presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y)
presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y) |>
mutate(presence = rbinom(1, 1, probs))
.
rbinom(n = 5, size = 1, prob = 0.7)
rbinom(n = 1, size = 1, prob = 0.7)
rbinom(n = 1, size = 1, prob = 0.7)
rbinom(n = 1, size = 1, prob = 0.7)
rbinom(n = 1, size = 1, prob = 0.7)
rbinom(n = 1, size = 1, prob = 0.7)
presence_points <- spatSample(r_vsp_presence, size = 20, na.rm=TRUE, xy = TRUE)
absence_points <- spatSample(r_vsp_absence, size = 20, na.rm=TRUE, xy = TRUE)
presence_points <- presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y) |>
mutate(presence = rbinom(1, 1, probs))
presence_points
presence_points <- presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y) |>
mutate(presence = rbinom(1, 1, probs))
presence_points
presence_points <- spatSample(r_vsp_presence, size = 20, na.rm=TRUE, xy = TRUE)
absence_points <- spatSample(r_vsp_absence, size = 20, na.rm=TRUE, xy = TRUE)
presence_points <- presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y)
presence_points$occurence <- rbinom(presence_points, 1, presence_points$probs)
presence_points <- spatSample(r_vsp_presence, size = 20, na.rm=TRUE, xy = TRUE)
absence_points <- spatSample(r_vsp_absence, size = 20, na.rm=TRUE, xy = TRUE)
presence_points <- presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y)
presence_points
presence_points$occurence <- rbinom(nrow(presence_points),
1,
presence_points$probs)
presence_points
r_vsp_presence
r_vsp %>% plot
presence_points
presence_points %>% filter(occurence == 1)
presence_points %>% filter(occurence == 1) %>% vect(geom = c("longitude", "latitude"))
pts_occ <- presence_points %>% filter(occurence == 1) %>% vect(geom = c("longitude", "latitude"))
pts_occ
points(pts_occ)
points(pts_occ, col = "red")
pts_occ <- presence_points %>% filter(occurence == 1) %>% vect(geom = c("longitude", "latitude"))
pts_abs <- presence_points %>% filter(occurence == 0) %>% vect(geom = c("longitude", "latitude"))
points(pts_abs, col = "orange")
points(pts_occ, col = "red")
points(pts_abs, col = "green")
points(pts_occ, col = "blue")
pts_abs <- presence_points %>% filter(occurence == 0) %>% vect(geom = c("longitude", "latitude"))
points(pts_occ, col = "blue")
plot(r_vsp)
points(pts_occ, col = "blue")
points(pts_abs, col = "green")
plot(r_vsp)
points(pts_occ, col = "red")
points(pts_abs, col = "black")
pts_occ
pts_abs
pts_occ
presence_points
presence_points <- spatSample(r_vsp_presence, size = 30, na.rm=TRUE, xy = TRUE)
absence_points <- spatSample(r_vsp_absence, size = 30, na.rm=TRUE, xy = TRUE)
presence_points <- presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y)
presence_points$occurence <- rbinom(nrow(presence_points),
1,
presence_points$probs)
pts_occ <- presence_points %>% filter(occurence == 1) %>% vect(geom = c("longitude", "latitude"))
pts_abs <- presence_points %>% filter(occurence == 0) %>% vect(geom = c("longitude", "latitude"))
points(pts_occ, col = "red")
plot(r_vsp)
points(pts_occ, col = "red")
points(pts_abs, col = "black")
presence_points %>%
presence_points
mus_virtualis
presence_points
presence_points %>%
mutate(species  = "spVirtual")
mus_virtualis
presence_points %>%
mutate(name  = "spVirtual") %>%
select(name, latitude, longitude, presence)
presence_points
presence_points %>%
mutate(name  = "spVirtual")
presence_points %>%
mutate(name  = "spVirtual") %>%
rename(presence = occurence) %>%
select(name, latitude, longitude, presence)
presence_points
presence_points %>%
mutate(name  = "spVirtual") %>%
rename(presence = occurence) %>%
select(name, latitude, longitude, presence)
sp_virtual_example <- presence_points %>%
mutate(name  = "spVirtual") %>%
rename(presence = occurence) %>%
select(name, latitude, longitude, presence)
sp_virtual_example
usethis::use_data(sp_virtual_example)
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(xsdmMle)
library(xsdmMle)
xsdmMle::sp_virtual_example
envdat_ex_occ
envdat_ex_occ <- envdat_ex[ , , occExample == 1]
envdat_ex_occ
envdat_ex_occ
occExample
envdat_ex
sp_virtual_example
envDataArray
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envData
envdat_ex
envdat_ex
occExample
envdat_ex
envData
envDataArray(envData)
envDataArray(envData)
envdat <- envDataArray(envData)
envdat
dim(envdat_ex)
dim(envdat)
envdat
sp_virtual_example
occExample
envdat_ex
envData
envdat <- envDataArray(envData, occ = sp_virtual_example)
envdat
dim(envdat)
occ <- sp_virtual_example$presence
envdat
envdat
occ
optim_df <- optim_mll(envdat, occ, numstarts = 10)
optim_df
param_list
param_list <-list(
mu = c(2, 250)
,sigl = c(0.5, 150)
,sigr = c(1.5, 75)
,c = -1.5
,pd = 0.9
,O = matrix(c(1, 0, 0, 1), ncol = 2)
)
param_list
param_list_example <- param_list
param_list_example
usethis::use_data(param_list_example)
paramListExample
param_list_example
devtools::document()
optim_df <- optim_mll(envdat, occ, numstarts = 100)
optim_df
View(optim_df)
param_list_example
optim_df <- optim_mll(envdat, occ, numstarts = 1000)
optim_df <- optim_mll(envdat, occ, numstarts = 1000, parallel = TRUE)
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envdat <- envDataArray(envData, occ = sp_virtual_example)
occ <- sp_virtual_example$presence
optim_df
optim_df <- optim_mll(envdat, occ, numstarts = 1000, parallel = TRUE)
optim_df
optim_df %>% ggplot() + geom_density(aes(mu1))
library(tidyverse)
install.packages("tidyverse")
optim_df %>%
ggplot() + geom_density(aes(mu1))
libary("tidyverse")
library("tidyverse")
optim_df %>%
ggplot() + geom_density(aes(mu1))
optim_df
optim_df
View(optim_df)
param_list_example
optim_df
optim_df %>% summarise(mu1 = median(mu1))
optim_df
optim_df
View(optim_df)
bio1_ts
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envdat <- envDataArray(envData, occ = sp_virtual_example)
occ <- sp_virtual_example$presence
optim_df <- optim_mll(envdat, occ, numstarts = 1000, parallel = TRUE)
optim_df
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envdat <- envDataArray(envData, occ = sp_virtual_example)
occ <- sp_virtual_example$presence
optim_df <- optim_mll(envdat, occ, numstarts = 100, parallel = TRUE)
param_list_example
optim_df %>%
ggplot() + geom_density(aes(mu1))
optim_df
optim_df %>%
summarise(mu1 = median(mu1))
optim_df %>%
summarise(mu1 = mean(mu1))
optim_df
optim_df
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
bio1_ts
bio12_ts
loglik_orthog_nd_unconstr
?math_to_bio
math_to_bio
expit(0.9)
expit(0.999)
expit(100)
expit(10)
sp_virtual_example
param_list
envdat
occ
list_of_pars
loglik_orthog_nd_unconstr
envdat <- envdat_ex
pa <- occExample
params <- paramTableExample[5, ]
params
param_vector <- params
loglik_orthog_nd_unconstr(params, envdat, pa)
pa
loglik_orthog_nd_unconstr
params
envdat
pa
envdat
envdat
params
math_to_bio(params)
RcppParallel::defaultNumThreads()%/%4
param_list
loglik_orthog_nd
loglik_orthog_nd_unconstr(params, envdat, pa)
params
envdat
envdat
pa
loglik_orthog_nd_unconstr(params, envdat, pa)
occ <- mus_virtualis[1:5, ]
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envArray <- xsdmMle::envDataArray(envData)
param_list <-list(
mu = c(2, 250)
,sigl = c(0.5, 150)
,sigr = c(1.5, 75)
,c = -1.5
,pd = 0.9
,O = matrix(c(1, 0, 0, 1), ncol = 2)
)
param_list_example <- param_list
param_list_example
r_vsp <- xsdmMle:::vsp(envData = envData,
param_list =  param_list)
r_vsp
r_vsp <- exp(r_vsp)
probs <- suppressWarnings(do.call(f_par, args = param_list))
M <- logprobdetect(envArray, mu, sigLtil, sigRtil, ctil, pd, O)
#plot(r_vsp - M)
M <- exp(M)
r <- cbind(crds(bio1_ts), M) |>
as.data.frame() |>
rast()
crs(r) <- crs(bio1_ts)
plot(r)
?terra::spatSample
r_vsp_presence <- as.data.frame(r_vsp,  xy = TRUE) %>%
tibble::tibble() %>%
dplyr::mutate(probs = ifelse(probs > 0.5, probs, NA)) %>%
terra::rast( crs = crs(r_vsp))
r_vsp_absence <- as.data.frame(r_vsp,  xy = TRUE) %>%
tibble::tibble() %>%
dplyr::mutate(probs = ifelse(probs < 0.5, probs, NA)) %>%
terra::rast( crs = crs(r_vsp))
panel(c(r_vsp_absence, r_vsp_presence))
r_vsp_presence %>% as.data.frame() %>% nrow()
presence_points <- spatSample(r_vsp_presence, size = 30, na.rm=TRUE, xy = TRUE)
absence_points <- spatSample(r_vsp_absence, size = 30, na.rm=TRUE, xy = TRUE)
presence_points <- presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y)
presence_points$occurence <- rbinom(nrow(presence_points),
1,
presence_points$probs)
pts_occ <- presence_points %>% filter(occurence == 1) %>% vect(geom = c("longitude", "latitude"))
pts_abs <- presence_points %>% filter(occurence == 0) %>% vect(geom = c("longitude", "latitude"))
plot(r_vsp)
points(pts_occ, col = "red")
points(pts_abs, col = "black")
sp_virtual_example <- presence_points %>%
mutate(name  = "spVirtual") %>%
rename(presence = occurence) %>%
select(name, latitude, longitude, presence)
usethis::use_data(sp_virtual_example)
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envdat <- envDataArray(envData, occ = sp_virtual_example)
envdat
occ <- sp_virtual_example$presence
occ
optim_df <- optim_mll(envdat, occ, numstarts = 100, parallel = TRUE)
optim_df <- optim_mll(envdat, occ, numstarts = 100, parallel = FALSE)
envdat
params
list_of_pars
param_vector
envdat <- envdat_ex
pa <- occExample
params <- paramTableExample[5, ]
param_vector <- params
loglik_orthog_nd_unconstr(params, envdat, pa)
params
params
param_vector
math_to_bio(param_vector)
params
paramTableExample
paramTableExample %>% tibble()
params
math_to_bio(paramTableExample)
math_to_bio(params)
paramTable
envdat_ex_occ
startparms(envdat_ex_occ)
startparms(envdat_ex_occ)
startParamsEx <-
startParamsEx <- startparms(envdat_ex_occ)
startParamsEx
math_to_bio(startParamsEx)
math_to_bio(startParamsEx[1, ])
math_to_bio(startParamsEx[2, ])
math_to_bio(startParamsEx[3, ])
math_to_bio(startParamsEx[4, ])
math_to_bio(startParamsEx[1, ])
math_to_bio(startParamsEx[2, ])
params
loglik_orthog_nd_unconstr(params, envdat, pa)
devtools::build_manual()
devtools::document()
usethis::use_readme_rmd()
pak::pak("alrobles/xsdmMle")
devtools::document()
devtools::build_readme()
envdat_ex
occExample
envdat_ex
envdat_ex[ ,2,]
envdat_ex[ 2,,]
envdat_ex
envdat_ex
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
bio12_ts
minmax(bio12_ts)
terra::minmax(bio12_ts)
bio12_ts <- bio12_ts/100
bio12_ts
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
bio12_ts <- bio12_ts/100
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envdat <- envDataArray(envData, occ = sp_virtual_example)
envdat
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
bio12_ts/100
bio12_ts <- bio12_ts/100
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envArray <- xsdmMle::envDataArray(envData)
envArray
param_list <-list(
mu = c(2, 3)
,sigl = c(0.5, 1)
,sigr = c(1.5, 0.75)
,c = -1.5
,pd = 0.9
,O = matrix(c(1, 0, 0, 1), ncol = 2)
)
param_list
r_vsp <- xsdmMle:::vsp(envData = envData,
param_list =  param_list)
r_vsp
r_vsp <- exp(r_vsp)
probs <- suppressWarnings(do.call(f_par, args = param_list))
param_list
r_vsp
r_vsp <- exp(r_vsp)
r_vsp
r_vsp <- xsdmMle:::vsp(envData = envData,
param_list =  param_list)
r_vsp
plot(r_vsp)
;library(terra)
library(terra)
plot(r_vsp)
r_vsp_presence <- as.data.frame(r_vsp,  xy = TRUE) %>%
tibble::tibble() %>%
dplyr::mutate(probs = ifelse(probs > 0.5, probs, NA)) %>%
terra::rast( crs = crs(r_vsp))
library(terra)
r_vsp_presence <- as.data.frame(r_vsp,  xy = TRUE) %>%
tibble::tibble() %>%
dplyr::mutate(probs = ifelse(probs > 0.5, probs, NA)) %>%
terra::rast( crs = crs(r_vsp))
r_vsp_absence <- as.data.frame(r_vsp,  xy = TRUE) %>%
tibble::tibble() %>%
dplyr::mutate(probs = ifelse(probs < 0.5, probs, NA)) %>%
terra::rast( crs = crs(r_vsp))
panel(c(r_vsp_absence, r_vsp_presence))
r_vsp_presence %>% as.data.frame() %>% nrow()
presence_points <- spatSample(r_vsp_presence, size = 30, na.rm=TRUE, xy = TRUE)
absence_points <- spatSample(r_vsp_absence, size = 30, na.rm=TRUE, xy = TRUE)
presence_points <- presence_points %>%
rbind(absence_points) |>
rename(longitude = x, latitude = y)
presence_points$occurence <- rbinom(nrow(presence_points),
1,
presence_points$probs)
pts_occ <- presence_points %>% filter(occurence == 1) %>% vect(geom = c("longitude", "latitude"))
pts_abs <- presence_points %>% filter(occurence == 0) %>% vect(geom = c("longitude", "latitude"))
plot(r_vsp)
points(pts_occ, col = "red")
points(pts_abs, col = "black")
sp_virtual_example <- presence_points %>%
mutate(name  = "spVirtual") %>%
rename(presence = occurence) %>%
select(name, latitude, longitude, presence)
sp_virtual_example
usethis::use_data(sp_virtual_example)
usethis::use_data(sp_virtual_example, overwrite = TRUE)
# param_list_example <- param_list
usethis::use_data(param_list_example, overwrite = TRUE)
devtools::document()
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
bio12_ts <- bio12_ts/100
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envdat <- envDataArray(envData, occ = sp_virtual_example)
envdat
occ <- sp_virtual_example$presence
occ
optim_df <- optim_mll(envdat, occ, numstarts = 100, parallel = FALSE)
optim_df
param_list_example
optim_df
optim_df <- optim_mll(envdat, occ, numstarts = 1000, parallel = TRUE)
optim_df
?ucminf::ucminf
bio1_ts <- terra::unwrap(cmcc_cm_bio1)
bio12_ts <- terra::unwrap(cmcc_cm_bio12)
bio12_ts <- bio12_ts/100
envData <- list(bio1 = bio1_ts, bio12 = bio12_ts)
envdat <- envDataArray(envData, occ = sp_virtual_example)
optim_df <- optim_mll(envdat, occ, numstarts = 500, parallel = TRUE)
envdat
optim_df
bio12_ts
optim_df
optim_df <- optim_mll(envdat, occ, numstarts = 50, parallel = TRUE)
param_list_example
optim_df
logit(1.32)
expit(1.32)
envdat
envData
sp_virtual_example
envdat
occ
devtools::build_readme()
